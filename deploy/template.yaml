AWSTemplateFormatVersion: "2010-09-09"
Transform: "AWS::Serverless-2016-10-31"
Description: "Digital Identity IPV Return API"

Parameters:
  CodeSigningConfigArn:
    Type: String
    Default: "none"
    Description: >
      The ARN of the Code Signing Config to use, provided by the deployment pipeline
  Environment:
    Description: "The environment type"
    Type: "String"
    AllowedValues:
      - "dev"
      - "build"
      - "staging"
      - "integration"
      - "production"
    ConstraintDescription: Ensure environment variable is set to one of dev, build, staging, integration or production.
  PermissionsBoundary:
    Description: "The ARN of the permissions boundary to apply when creating IAM roles"
    Type: String
    Default: "none"
  SecretPrefix:
    Type: String
    Default: "none"
    Description: Secrets name prefix
  VpcStackName:
    Type: String
    Default: "vpc-cri"
    Description: The name of the VPC stack deployed.
#  L2DynamoStackName:
#    Type: String
#    Default: "f2f-cri-ddb"
#    Description: The name of the L2 DynamoDB stack deployed.
#  L2KMSStackName:
#    Type: String
#    Default: "f2f-cri-kms"
#    Description: The name of the L2 DynamoDB stack deployed.

Mappings:
  EnvironmentConfiguration: # This is where you store per-environment settings.
    dev:
      logretentionindays: 3
      apiTracingEnabled: true
    build:
      logretentionindays: 3
      apiTracingEnabled: true
    staging:
      logretentionindays: 3
      apiTracingEnabled: true
    integration:
      logretentionindays: 30
      apiTracingEnabled: false
    production:
      logretentionindays: 30
      apiTracingEnabled: false

  PlatformConfiguration:
    dev:
      CSLSEGRESS: arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython
    build:
      CSLSEGRESS: arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython
    staging:
      CSLSEGRESS: arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython
    integration:
      CSLSEGRESS: arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython
    production:
      CSLSEGRESS: arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython

  EnvironmentVariables: # This is all the environment specific environment variables that don't belong in globals.
    dev:
      YOTIBASEURL: "https://f2f-cri-outbound-proxy-proxy.review-o.dev.account.gov.uk/yoti"
      #YOTIBASEURL: "https://f2f-yoti-stub-yotistub.review-o.dev.account.gov.uk"
      YOTISDK: "1f9edc97-c60c-40d7-becb-c1c6a2ec4963"
      #YOTISDK: "Mock1234"
      YOTICALLBACKURL: "https://some-domain.example"
      ISSUER: 'https://review-o.dev.account.gov.uk'
      DNSSUFFIX: review-o.dev.account.gov.uk
      MESSAGERETENTIONPERIODDAYS: 345600 # Default: 4 days
      GOVUKNOTIFYTEMPLATEID: "bea2a584-4dca-4970-a90d-93977e752fdf"
      CLIENTSESSIONTOKENTTL: 604800 # Default 7 days
      RESOURCESTTL: 691200 # Default 8 days
      CLIENTS: '[{"jwksEndpoint":"https://f2f-ipv-stub-ipvstub.review-o.dev.account.gov.uk/.well-known/jwks.json","clientId":"5C584572","redirectUri":"https://f2f-ipv-stub-ipvstub.review-o.dev.account.gov.uk/redirect"}]'
      AUTHSESSIONTTL: "604800" # 7 days in seconds
    build:
      YOTIBASEURL: "https://proxy.review-o.build.account-gov.uk/yoti"
      YOTISDK: "1f9edc97-c60c-40d7-becb-c1c6a2ec4963"
      YOTICALLBACKURL: "https://some-domain.example"
      ISSUER: 'https://review-o.build.account.gov.uk'
      DNSSUFFIX: review-o.build.account.gov.uk
      MESSAGERETENTIONPERIODDAYS: 345600 # Default: 4 days
      GOVUKNOTIFYTEMPLATEID: "bea2a584-4dca-4970-a90d-93977e752fdf"
      CLIENTSESSIONTOKENTTL: 604800 # Default 7 days
      RESOURCESTTL: 691200 # Default 8 days
      CLIENTS: '[{"jwksEndpoint":"https://f2f-ipv-stub-ipvstub.review-o.build.account.gov.uk/.well-known/jwks.json","clientId":"BD7B2A5D","redirectUri":"https://f2f-ipv-stub-ipvstub.review-o.build.account.gov.uk/redirect"}]'
      AUTHSESSIONTTL: "604800" # 7 days in seconds
    staging:
      YOTIBASEURL: "https://proxy.review-o.staging.account-gov.uk/yoti"
      YOTISDK: "596d953d-2451-46c8-8553-ebb0d1a75698"
      YOTICALLBACKURL: "https://some-domain.example"
      ISSUER: 'https://review-o.staging.account.gov.uk'
      DNSSUFFIX: review-o.staging.account.gov.uk
      MESSAGERETENTIONPERIODDAYS: 345600 # Default: 4 days
      GOVUKNOTIFYTEMPLATEID: "bea2a584-4dca-4970-a90d-93977e752fdf"
      CLIENTSESSIONTOKENTTL: 604800 # Default 7 days
      RESOURCESTTL: 691200 # Default 8 days
      CLIENTS: '[{"jwksEndpoint":"https://api.identity.staging.account.gov.uk/.well-known/jwks.json","clientId":"03A5A659-17AA-453F-B905-95D2804823D1","redirectUri":"https://identity.staging.account.gov.uk/redirect"}]'
      AUTHSESSIONTTL: "604800" # 7 days in seconds
    integration:
      YOTIBASEURL: "https://proxy.review-o.integration.account-gov.uk/yoti"
      YOTISDK: "cb78093e-0686-4f86-8e7c-ded6117502e8"
      YOTICALLBACKURL: "https://some-domain.example"
      ISSUER: 'https://review-o.integration.account.gov.uk'
      DNSSUFFIX: review-o.integration.account.gov.uk
      MESSAGERETENTIONPERIODDAYS: 345600 # Default: 4 days
      GOVUKNOTIFYTEMPLATEID: "bea2a584-4dca-4970-a90d-93977e752fdf"
      CLIENTSESSIONTOKENTTL: 604800 # Default 7 days
      RESOURCESTTL: 691200 # Default 8 days
      CLIENTS: '[{"jwksEndpoint":"https://api.identity.integration.account.gov.uk/.well-known/jwks.json", "clientId":"AE140E43-1987-4EE8-86CC-BEF19FC9FF3F", "redirectUri":"https://identity.integration.account.gov.uk/redirect"}]'
      AUTHSESSIONTTL: "604800" # 7 days in seconds
    production:
      YOTIBASEURL: "https://proxy.review-o.account-gov.uk/yoti"
      YOTISDK: "81402882-b37c-4348-b336-437cdbb232bb"
      YOTICALLBACKURL: "https://some-domain.example"
      ISSUER: 'https://review-o.account.gov.uk'
      DNSSUFFIX: review-o.account.gov.uk
      MESSAGERETENTIONPERIODDAYS: 345600 # Default: 4 days
      GOVUKNOTIFYTEMPLATEID: "bea2a584-4dca-4970-a90d-93977e752fdf"
      CLIENTSESSIONTOKENTTL: 604800 # Default 7 days
      RESOURCESTTL: 691200 # Default 8 days
      CLIENTS: '[{"jwksEndpoint":"https://api.identity.account.gov.uk/.well-known/jwks.json", "clientId":"C910A762-4BB2-400D-8F3D-4D7E6C84E342", "redirectUri":"https://identity.account.gov.uk/redirect"}]'
      AUTHSESSIONTTL: "604800" # 7 days in seconds
  TxMAAccounts:
    # EVENTS is used to egress to TxMA.
    dev:
      AUDIT: arn:aws:iam::725018305812:root
      EVENTS: arn:aws:iam::248098332657:root
    build:
      AUDIT: arn:aws:iam::761029721660:root
      EVENTS: arn:aws:iam::750703655225:root
    staging:
      AUDIT: arn:aws:iam::778587367904:root
      EVENTS: arn:aws:iam::178023842775:root
    integration:
      AUDIT: arn:aws:iam::423448613278:root
      EVENTS: arn:aws:iam::729485541398:root
    production:
      AUDIT: arn:aws:iam::348043515437:root
      EVENTS: arn:aws:iam::451773080033:root

Conditions:
  CreateDevResources: !Equals
    - !Ref Environment
    - dev
  IsProdLikeEnvironment: !Or
    - !Equals [!Ref Environment, staging]
    - !Equals [!Ref Environment, integration]
    - !Equals [!Ref Environment, production]
  UseCodeSigning:
    Fn::Not:
      - Fn::Equals:
          - !Ref CodeSigningConfigArn
          - "none"
  UsePermissionsBoundary:
    Fn::Not:
      - Fn::Equals:
          - !Ref PermissionsBoundary
          - "none"
  UseSecretPrefix:
    Fn::Not:
      - Fn::Equals:
          - !Ref SecretPrefix
          - "none"

Globals:
  Function:
    Runtime: nodejs18.x
    VpcConfig:
      SecurityGroupIds:
        - !GetAtt LambdaEgressSecurityGroup.GroupId
      SubnetIds:
        - Fn::ImportValue:
            "Fn::Sub": "${VpcStackName}-ProtectedSubnetIdA"
        - Fn::ImportValue:
            "Fn::Sub": "${VpcStackName}-ProtectedSubnetIdB"
    PermissionsBoundary: !If
      - UsePermissionsBoundary
      - !Ref PermissionsBoundary
      - !Ref AWS::NoValue
    CodeSigningConfigArn: !If
      - UseCodeSigning
      - !Ref CodeSigningConfigArn
      - !Ref AWS::NoValue
    Timeout: 30 # seconds
    Tracing: Active
    MemorySize: 1024
    Architectures:
      - arm64
    Environment:
      Variables:
        # These should always be alphabetically organised.
        AWS_STACK_NAME: !Sub ${AWS::StackName} # The AWS Stack Name, as passed into the template.
        POWERTOOLS_LOG_LEVEL: DEBUG # The LogLevel for the AWS PowerTools LogHelper
        POWERTOOLS_METRICS_NAMESPACE: F2F-CRI # The Metric Namespace for the AWS PowerTools MetricHelper
#        SESSION_TABLE:
#          Fn::ImportValue: !Sub "${L2DynamoStackName}-session-table-name"
        SECRET_PREFIX: !If [
          UseSecretPrefix,
          !Ref SecretPrefix,
          !Ref AWS::StackName,
        ] # What is this? @TODO
        #  SQS_AUDIT_EVENT_PREFIX: CIC-F2F # The prefix to add to TxMA event messages
    AutoPublishAlias: live

Resources:
  LambdaEgressSecurityGroup:
    Type: "AWS::EC2::SecurityGroup"
    Properties:
      GroupDescription: >-
        Permits outbound on port 443 from within the VPC to the internet.
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow to the wider internet on port 443
          FromPort: 443
          IpProtocol: tcp
          ToPort: 443
      VpcId:
        Fn::ImportValue: !Sub "${VpcStackName}-VpcId"


  ### Function Definition
  ## SessionHandler
  PostEventFunction:
    Type: AWS::Serverless::Function
    DependsOn: PostEventFunctionLogGroup
    Properties:
      FunctionName: !Sub "IPR-PostEvent-${AWS::StackName}"
      Handler: PostEventHandler.lambdaHandler
      CodeUri: ../src/
      Environment:
        Variables:
          POWERTOOLS_SERVICE_NAME: PostEventHandler
#          PERSON_IDENTITY_TABLE_NAME:
#            Fn::ImportValue: !Sub "${L2DynamoStackName}-person-identity-table-name"
#          TXMA_QUEUE_URL: !Ref TxMASQSQueue

      Policies:
        - AWSLambdaBasicExecutionRole
        - AWSXrayWriteOnlyAccess
#        - DynamoDBWritePolicy:
#            TableName:
#              Fn::ImportValue: !Sub "${L2DynamoStackName}-session-table-name"
#        - DynamoDBReadPolicy:
#            TableName:
#              Fn::ImportValue: !Sub "${L2DynamoStackName}-session-table-name"
#        - DynamoDBWritePolicy:
#            TableName:
#              Fn::ImportValue: !Sub "${L2DynamoStackName}-person-identity-table-name"
#        - KMSDecryptPolicy:
#            KeyId:
#              Fn::ImportValue: !Sub "${L2DynamoStackName}-session-table-key-id"
#        - Statement:
#            - Sid: KMSPolicy
#              Effect: Allow
#              Action:
#                - kms:*
#              Resource:
#                "*"
              #Fn::ImportValue: !Sub "${L2KMSStackName}-vc-signing-key"
              #Resource: !Sub "arn:aws:kms:eu-west-2:060113405249:key/ff437a51-ec7e-4118-9c95-7b0bb2856836"
#        - Statement:
#            - Effect: Allow
#              Action:
#                - "sqs:SendMessage"
#              Resource: !GetAtt TxMASQSQueue.Arn
#            - Effect: Allow
#              Action:
#                - "kms:Encrypt"
#                - "kms:Decrypt"
#                - "kms:GenerateDataKey"
#              Resource: !GetAtt TxMAKMSEncryptionKey.Arn
#      Events:
#        session:
#          Type: Api
#          Properties:
#            Path: /session
#            Method: post
#            RestApiId: !Ref F2FRestApi

    Metadata: # Manage esbuild properties
      BuildMethod: esbuild
      BuildProperties:
        Minify: true
        Target: "es2020"
        Sourcemap: false # Enabling source maps will create the required NODE_OPTIONS environment variables on your lambda function during sam build
        EntryPoints:
          - PostEventHandler.ts

  PostEventFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/lambda/IPR-PostEvent-${AWS::StackName}"
      RetentionInDays:
        !FindInMap [
          EnvironmentConfiguration,
          !Ref Environment,
          logretentionindays,
        ]

  PostEventFunctionLogsSubscriptionFilterCSLS:
    Type: AWS::Logs::SubscriptionFilter
    Condition: IsProdLikeEnvironment
    Properties:
      DestinationArn: "arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython"
      FilterPattern: ""
      LogGroupName: !Ref PostEventFunctionLogGroup

  PostEventFunctionPermission:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName: !Ref PostEventFunction
      Principal: apigateway.amazonaws.com

#  TxMASQSQueue:
#    Type: AWS::SQS::Queue
#    Properties:
#      MessageRetentionPeriod: !FindInMap [EnvironmentVariables, !Ref Environment, MESSAGERETENTIONPERIODDAYS]
#      VisibilityTimeout: 60
#      KmsMasterKeyId: !Ref TxMAKeyAlias
#      RedrivePolicy:
#        deadLetterTargetArn:
#          Fn::GetAtt:
#            - "TxMASQSQueueDeadLetterQueue"
#            - "Arn"
#        maxReceiveCount: 5

#  TxMASQSQueuePolicy:
#    Type: AWS::SQS::QueuePolicy
#    Properties:
#      Queues:
#        - !Ref TxMASQSQueue
#      PolicyDocument:
#        Version: "2012-10-17"
#        Statement:
#          - Effect: "Allow"
#            Action:
#              - "sqs:DeleteMessage"
#              - "sqs:GetQueueAttributes"
#              - "sqs:ChangeMessageVisibility"
#              - "sqs:ReceiveMessage"
#            Resource:
#              - !GetAtt TxMASQSQueue.Arn
#            Principal:
#              AWS:
#                - !FindInMap [TxMAAccounts, !Ref Environment, EVENTS]
#
#  TxMASQSQueueDeadLetterQueue:
#    Type: AWS::SQS::Queue
#    Properties:
#      MessageRetentionPeriod: 259200 # three days
#      KmsMasterKeyId: !Sub TxMAKMSEncryptionKey
#
#  TxMAKMSEncryptionKey:
#    Type: AWS::KMS::Key
#    # KMS Key manually rotated.
#    # checkov:skip=CKV_AWS_7: KMS Key manually rotated.
#    Properties:
#      Description: A KMS Key for encrypting the SQS Queue for TxMA
#      Enabled: true
#      KeyPolicy:
#        Version: "2012-10-17"
#        Statement:
#          - Effect: Allow
#            Principal:
#              AWS: !Sub "arn:aws:iam::${AWS::AccountId}:root"
#            Action:
#              - "kms:*"
#            Resource:
#              - "*"
#          - Effect: Allow
#            Principal:
#              AWS: !FindInMap [TxMAAccounts, !Ref Environment, EVENTS]
#            Action:
#              - "kms:Encrypt"
#              - "kms:Decrypt"
#              - "kms:GenerateDataKey"
#            Resource:
#              - "*"
#      KeySpec: SYMMETRIC_DEFAULT
#      KeyUsage: ENCRYPT_DECRYPT
#      MultiRegion: false
#      PendingWindowInDays: 7
#      Tags:
#        - Key: KeyType
#          Value: Encryption Key
#        - Key: Environment
#          Value: !Sub ${Environment}
#
#  TxMAKeyAlias:
#    Type: AWS::KMS::Alias
#    Properties:
#      AliasName: !If
#        - CreateDevResources
#        - !Sub "alias/TxMAKMSEncryptionKey-${AWS::StackName}"
#        - alias/TxMAKMSEncryptionKey
#      TargetKeyId: !Ref TxMAKMSEncryptionKey

#
#  GovNotifyFunction:
#    Type: AWS::Serverless::Function
#    DependsOn: GovNotifyFunctionLogGroup
#    Properties:
#      FunctionName: !Sub "F2F-GovNotify-${AWS::StackName}"
#      Handler: GovNotifyHandler.lambdaHandler
#      CodeUri: ../src/
#      Environment:
#        Variables:
#          POWERTOOLS_SERVICE_NAME: GovNotifyHandler
#          ISSUER: !FindInMap [EnvironmentVariables, !Ref Environment, ISSUER]
#          TXMA_QUEUE_URL: !Ref TxMASQSQueue
#          GOVUKNOTIFY_TEMPLATE_ID: !FindInMap [ EnvironmentVariables, !Ref Environment, GOVUKNOTIFYTEMPLATEID ]
#          YOTI_KEY_SSM_PATH: !Sub "/${Environment}/YOTI/PRIVATEKEY"
#          GOVUKNOTIFY_API_KEY_SSM_PATH: !Sub "/${Environment}/f2f-gov-notify/GOVUKNOTIFY_API_KEY"
#          YOTIBASEURL: !FindInMap [ EnvironmentVariables, !Ref Environment, YOTIBASEURL ]
#          YOTISDK: !FindInMap [ EnvironmentVariables, !Ref Environment, YOTISDK ]
#          CLIENT_SESSION_TOKEN_TTL: !FindInMap [EnvironmentVariables, !Ref Environment, CLIENTSESSIONTOKENTTL]
#          RESOURCES_TTL: !FindInMap [EnvironmentVariables, !Ref Environment, RESOURCESTTL]
#      Policies:
#        - AWSLambdaBasicExecutionRole
#        - AWSXrayWriteOnlyAccess
#        - SSMParameterReadPolicy:
#            ParameterName: !Sub "${Environment}/YOTI/PRIVATEKEY"
#        - SSMParameterReadPolicy:
#            ParameterName: !Sub "${Environment}/f2f-gov-notify/GOVUKNOTIFY_API_KEY"
#        - DynamoDBWritePolicy:
#            TableName:
#              Fn::ImportValue:
#                !Sub "${L2DynamoStackName}-session-table-name"
#        - DynamoDBReadPolicy:
#            TableName:
#              Fn::ImportValue:
#                !Sub "${L2DynamoStackName}-session-table-name"
#        - KMSDecryptPolicy:
#            KeyId:
#              Fn::ImportValue:
#                !Sub "${L2DynamoStackName}-session-table-key-id"
#        - Statement:
#            - Effect: Allow
#              Action:
#                - "sqs:SendMessage"
#              Resource: !GetAtt TxMASQSQueue.Arn
#            - Effect: Allow
#              Action:
#                - "kms:Encrypt"
#                - "kms:Decrypt"
#                - "kms:GenerateDataKey"
#              Resource: !GetAtt TxMAKMSEncryptionKey.Arn
#            - Effect: Allow
#              Action:
#                - "kms:Decrypt"
#              Resource: !GetAtt GovNotifyEncryptionKey.Arn
#      Events:
#        SQSEvent:
#          Type: SQS
#          Properties:
#            Queue: !GetAtt GovNotifySQSQueue.Arn
#            BatchSize: 1
#            Enabled: true
#            FunctionResponseTypes:
#              - ReportBatchItemFailures
#    Metadata: # Manage esbuild properties
#      BuildMethod: esbuild
#      BuildProperties:
#        Minify: true
#        Target: "es2020"
#        Sourcemap: false # Enabling source maps will create the required NODE_OPTIONS environment variables on your lambda function during sam build
#        EntryPoints:
#          - GovNotifyHandler.ts
#
#  GovNotifyFunctionLogGroup:
#    Type: AWS::Logs::LogGroup
#    Properties:
#      LogGroupName: !Sub "/aws/lambda/F2F-GovNotify-${AWS::StackName}"
#      RetentionInDays:
#        !FindInMap [
#          EnvironmentConfiguration,
#          !Ref Environment,
#          logretentionindays,
#        ]
#
#  GovNotifyFunctionLogsSubscriptionFilterCSLS:
#    Type: AWS::Logs::SubscriptionFilter
#    Condition: IsProdLikeEnvironment
#    Properties:
#      DestinationArn: "arn:aws:logs:eu-west-2:885513274347:destination:csls_cw_logs_destination_prodpython"
#      FilterPattern: ""
#      LogGroupName: !Ref GovNotifyFunctionLogGroup
#
#  GovNotifyFunctionPermission:
#    Type: AWS::Lambda::Permission
#    Properties:
#      Action: lambda:InvokeFunction
#      FunctionName: !Ref GovNotifyFunction
#      Principal: apigateway.amazonaws.com
#
#
#  #Gov Notify SQS Queue
#  GovNotifySQSQueue:
#    Type: "AWS::SQS::Queue"
#    Properties:
#      MessageRetentionPeriod: !FindInMap [EnvironmentVariables, !Ref Environment, MESSAGERETENTIONPERIODDAYS]
#      VisibilityTimeout: 60
#      KmsMasterKeyId: !Ref GovNotifyKeyAlias
#      RedrivePolicy:
#        deadLetterTargetArn:
#          Fn::GetAtt:
#            - "GovNotifySQSQueueDeadLetterQueue"
#            - "Arn"
#        maxReceiveCount: 5
#
#  GovNotifySQSQueueDeadLetterQueue:
#    Type: "AWS::SQS::Queue"
#    Properties:
#      MessageRetentionPeriod: 259200 # three days
#      KmsMasterKeyId: !Sub GovNotifyEncryptionKey
#
#  GovNotifySQSQueuePolicy:
#    Type: "AWS::SQS::QueuePolicy"
#    Properties:
#      Queues:
#        - !Ref GovNotifySQSQueue
#      PolicyDocument:
#        Version: "2012-10-17"
#        Statement:
#          - Effect: "Allow"
#            Principal:
#              Service: "lambda.amazonaws.com"
#            Action:
#              - "sqs:ReceiveMessage"
#              - "sqs:DeleteMessage"
#            Resource: !GetAtt GovNotifySQSQueue.Arn
#
#  GovNotifyEncryptionKey:
#    Type: AWS::KMS::Key
#    # KMS Key manually rotated.
#    # checkov:skip=CKV_AWS_7: KMS Key manually rotated.
#    Properties:
#      Description: A KMS Key for encrypting the SQS Queue for GovNotify
#      Enabled: true
#      KeyPolicy:
#        Version: "2012-10-17"
#        Statement:
#          - Effect: Allow
#            Principal:
#              AWS: !Sub "arn:aws:iam::${AWS::AccountId}:root"
#            Action:
#              - "kms:*"
#            Resource:
#              - "*"
#      KeySpec: SYMMETRIC_DEFAULT
#      KeyUsage: ENCRYPT_DECRYPT
#      MultiRegion: false
#      PendingWindowInDays: 7
#      Tags:
#        - Key: KeyType
#          Value: Encryption Key
#        - Key: Environment
#          Value: !Sub ${Environment}
#
#  GovNotifyKeyAlias:
#    Type: AWS::KMS::Alias
#    Properties:
#      AliasName: !If
#        - CreateDevResources
#        - !Sub "alias/GovNotifyEncryptionKey-${AWS::StackName}"
#        - alias/GovNotifyEncryptionKey
#      TargetKeyId: !Ref GovNotifyEncryptionKey

#Outputs:
#  F2FApiGatewayId:
#    Description: "API GatewayID of the F2F CRI API"
#    Value: !Sub "${F2FRestApi}"
#    Export:
#      Name: !Sub ${AWS::StackName}-F2FApiGatewayId
#  F2FBackendURL:
#    Description: "F2F Backend URL"
#    Value: !Sub
#      - "https://api-${AWS::StackName}.${DNSSUFFIX}/"
#      - DNSSUFFIX:
#          !FindInMap [ EnvironmentVariables, !Ref Environment, DNSSUFFIX ]
#    Export:
#      Name: !Sub ${AWS::StackName}-F2FBackendURL
